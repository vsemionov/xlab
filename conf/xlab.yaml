seed_everything: 42
trainer:
  accelerator: auto
  strategy: auto
  devices: auto
  num_nodes: 1
  precision: 16-mixed
  logger:
    class_path: TensorBoardLogger
    init_args:
      save_dir: .
  callbacks:
    - class_path: RichModelSummary
      init_args:
        max_depth: 5
    - XLabRichProgressBar
    - class_path: LearningRateMonitor
      init_args:
        logging_interval: epoch
    - class_path: ModelCheckpoint
      init_args:
        monitor: val_loss
        save_last: true
        save_top_k: 10
        mode: min
  max_epochs: 20
  enable_model_summary: false  # prevents a warning that the callback is already configured
  deterministic: true
model:
  max_len: 128
  d_model: 256
  position: xlab.transformers.PositionalEncoding
  n_blocks: 4
  n_heads: 4
  d_ff: 512
  dropout: 0.1
  prenorm: false
  postnorm: false
  norm: torch.nn.LayerNorm
  activation: torch.nn.ReLU
  attn_drop: true
  ff_drop: true
data:
  path: wikipedia
  name: 20220301.simple
  splits:
    train: 0.9
    val: 0.05
    test: 0.025
    predict: 0  # use remainder
  tokenizer: basic_english
  language: en
  max_tokens: 20_000
  column: text
  num_proc: 4
  progress: tqdm
  chunk_size: 0.5
  batch_size: 256
  pin_memory: true
  num_workers: 4
  persistent_workers: true
optimizer:
  class_path: Adam
  init_args:
    lr: 3e-4
    weight_decay: 0.0
lr_scheduler:
  class_path: ReduceLROnPlateau
  init_args:
    monitor: val_loss
    mode: min
    threshold: 1e-4
    threshold_mode: rel
    factor: 0.1
    patience: 2
    min_lr: 1e-5
